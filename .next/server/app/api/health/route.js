"use strict";(()=>{var e={};e.id=829,e.ids=[829],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6005:e=>{e.exports=require("node:crypto")},4891:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>S,requestAsyncStorage:()=>d,routeModule:()=>u,serverHooks:()=>m,staticGenerationAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{GET:()=>l,OPTIONS:()=>h});var a=r(9303),i=r(8716),n=r(670),o=r(7070),c=r(7107),p=r(6120);async function l(e){let t=Date.now();try{let e;let r=await (0,p.pb)(),s=(0,c.MJ)(),a=Object.fromEntries(Object.entries(s).map(([e,t])=>[e,{size:t.size,hitRate:Math.round(100*t.hitRate)/100}])),i={status:e=r.connected?"healthy":r.error&&r.error.includes("CRITICAL")?"unhealthy":"degraded",timestamp:new Date().toISOString(),services:{redis:r,cache:{l1Stats:a}},version:process.env.npm_package_version||"1.0.0"},n=Date.now()-t,l=new Headers({"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate","X-Processing-Time":`${n}ms`,"X-Health-Status":e});return o.NextResponse.json(i,{headers:l,status:"unhealthy"===e?503:200})}catch(t){console.error("[API] /api/health error:",t);let e={status:"unhealthy",timestamp:new Date().toISOString(),services:{redis:{connected:!1,error:t instanceof Error?t.message:"Unknown error"},cache:{l1Stats:{}}}};return o.NextResponse.json(e,{status:503})}}async function h(){return new o.NextResponse(null,{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, OPTIONS","Access-Control-Allow-Headers":"Content-Type"}})}let u=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/health/route",pathname:"/api/health",filename:"route",bundlePath:"app/api/health/route"},resolvedPagePath:"/Users/ken/Desktop/quantiv/app/api/health/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:g,serverHooks:m}=u,y="/api/health/route";function S(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:g})}},7107:(e,t,r)=>{r.d(t,{MJ:()=>n,Oj:()=>i,ZU:()=>o});var s=r(138);class a{constructor(e,t={}){this.hits=0,this.misses=0,this.name=e,this.cache=new s.z({max:t.maxSize||100,ttl:t.ttlMs||6e4,updateAgeOnGet:t.updateAgeOnGet??!0,dispose:(e,t)=>{console.debug(`[${this.name}] Evicted cache entry: ${t}`)}})}get(e){let t=this.cache.get(e);return t?(this.hits++,t.data):(this.misses++,null)}set(e,t,r){let s={data:t,timestamp:Date.now(),key:e};r?this.cache.set(e,s,{ttl:r}):this.cache.set(e,s)}has(e){return this.cache.has(e)}delete(e){return this.cache.delete(e)}clear(){this.cache.clear(),this.hits=0,this.misses=0}getStats(){let e=this.hits+this.misses;return{name:this.name,size:this.cache.size,maxSize:this.cache.max,hits:this.hits,misses:this.misses,hitRate:e>0?this.hits/e*100:0,calculatedSize:this.cache.calculatedSize||0}}async getOrSet(e,t,r){let s=this.get(e);if(null!==s)return s;try{let s=await t();return this.set(e,s,r),s}catch(t){throw console.error(`[${this.name}] Error fetching data for key ${e}:`,t),t}}peek(e){let t=this.cache.peek(e);return t?t.data:null}keys(){return Array.from(this.cache.keys())}getInfo(){let e=[],t=Date.now();for(let[r,s]of Array.from(this.cache.entries()))e.push({key:r,timestamp:s.timestamp,age:t-s.timestamp});return{name:this.name,entries:e,stats:this.getStats()}}}let i={optionsChain:new a("options-chain",{maxSize:200,ttlMs:6e4,updateAgeOnGet:!0}),expectedMove:new a("expected-move",{maxSize:150,ttlMs:9e4,updateAgeOnGet:!0}),earnings:new a("earnings",{maxSize:100,ttlMs:3e5,updateAgeOnGet:!0}),priceHistory:new a("price-history",{maxSize:50,ttlMs:6e5,updateAgeOnGet:!1}),ivSeries:new a("iv-series",{maxSize:100,ttlMs:18e5,updateAgeOnGet:!1})};function n(){return{optionsChain:i.optionsChain.getStats(),expectedMove:i.expectedMove.getStats(),earnings:i.earnings.getStats(),priceHistory:i.priceHistory.getStats(),ivSeries:i.ivSeries.getStats()}}let o={optionsChain:(e,t)=>`${e.toUpperCase()}:${t}`,expectedMove:(e,t)=>`${e.toUpperCase()}:${t}`,earnings:e=>e.toUpperCase(),priceHistory:(e,t)=>`${e.toUpperCase()}:${t}d`,ivSeries:(e,t)=>`${e.toUpperCase()}:${t}d`}},6120:(e,t,r)=>{r.d(t,{ES:()=>i,O4:()=>n,R8:()=>a,pb:()=>o});let s=new(r(6859)).s({url:process.env.REDIS_URL,token:process.env.REDIS_TOKEN}),a={expectedMoveSnapshot:(e,t)=>`em:snap:${e.toUpperCase()}:${t}`,topMovers:e=>`em:top:${e}`,ivSeries:e=>`iv:series:${e.toUpperCase()}`,dailyVisits:e=>`d:visits:${e}`,optionsChain:(e,t)=>`chain:${e.toUpperCase()}:${t}`,earnings:e=>`earnings:${e.toUpperCase()}`,priceHistory:e=>`prices:${e.toUpperCase()}`};class i{static async setJson(e,t,r=120){try{await s.setex(e,r,JSON.stringify(t))}catch(t){console.error(`Redis setJson error for key ${e}:`,t)}}static async getJson(e){try{let t=await s.get(e);return t?JSON.parse(t):null}catch(t){return console.error(`Redis getJson error for key ${e}:`,t),null}}static async increment(e,t){try{let r=await s.incr(e);return t&&1===r&&await s.expire(e,t),r}catch(t){return console.error(`Redis increment error for key ${e}:`,t),0}}static async addToSortedSet(e,t,r,a){try{await s.zadd(e,{score:t,member:r}),a&&await s.expire(e,a)}catch(t){console.error(`Redis zadd error for key ${e}:`,t)}}static async getTopFromSortedSet(e,t=10){try{let r=await s.zrange(e,0,t-1,{rev:!0,withScores:!0}),a=[];for(let e=0;e<r.length;e+=2)a.push({member:r[e],score:r[e+1]});return a}catch(t){return console.error(`Redis zrange error for key ${e}:`,t),[]}}static async delete(e){try{await s.del(e)}catch(t){console.error(`Redis delete error for key ${e}:`,t)}}static async exists(e){try{let t=await s.exists(e);return 1===t}catch(t){return console.error(`Redis exists error for key ${e}:`,t),!1}}static async getTTL(e){try{return await s.ttl(e)}catch(t){return console.error(`Redis TTL error for key ${e}:`,t),-1}}}class n{static async cacheExpectedMove(e,t,r,s=120){let n=a.expectedMoveSnapshot(e,t),o={...r,timestamp:new Date().toISOString(),symbol:e.toUpperCase(),expiry:t};await i.setJson(n,o,s)}static async getExpectedMove(e,t){let r=a.expectedMoveSnapshot(e,t);return await i.getJson(r)}static async incrementVisitorCount(){let e=new Date().toISOString().split("T")[0].replace(/-/g,""),t=a.dailyVisits(e);return await i.increment(t,172800)}static async getVisitorCount(e){let t=e||new Date().toISOString().split("T")[0].replace(/-/g,""),r=a.dailyVisits(t);try{let e=await s.get(r);return e?parseInt(e,10):0}catch(e){return console.error(`Error getting visitor count for ${t}:`,e),0}}static async cacheIVSeries(e,t,r=86400){let s=a.ivSeries(e);await i.setJson(s,t,r)}static async getIVSeries(e){let t=a.ivSeries(e);return await i.getJson(t)}static async addTopMover(e,t,r){let s=r||new Date().toISOString().split("T")[0].replace(/-/g,""),n=a.topMovers(s);await i.addToSortedSet(n,t,e.toUpperCase(),86400)}static async getTopMovers(e,t=10){let r=e||new Date().toISOString().split("T")[0].replace(/-/g,""),s=a.topMovers(r);return(await i.getTopFromSortedSet(s,t)).map(e=>({symbol:e.member,expectedMovePct:e.score}))}}async function o(){try{let e=Date.now();await s.ping();let t=Date.now()-e;return{connected:!0,latency:t}}catch(e){return{connected:!1,error:e instanceof Error?e.message:"Unknown error"}}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,982,138],()=>r(4891));module.exports=s})();