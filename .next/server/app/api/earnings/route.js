"use strict";(()=>{var e={};e.id=700,e.ids=[700],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6005:e=>{e.exports=require("node:crypto")},8466:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>x,patchFetch:()=>R,requestAsyncStorage:()=>h,routeModule:()=>g,serverHooks:()=>v,staticGenerationAsyncStorage:()=>y});var i={};a.r(i),a.d(i,{GET:()=>d,OPTIONS:()=>u});var s=a(9303),n=a(8716),r=a(670),o=a(7070),c=a(5074),p=a(7107),l=a(6120);class m{static async getEarningsData(e){await new Promise(e=>setTimeout(e,120));let t=new Date,a=new Date(t.getTime()+6048e5),i=Math.random()>.3?{date:a.toISOString().split("T")[0],confidence:Math.random()>.5?"confirmed":"estimated",timing:Math.random()>.5?"bmo":"amc",estimate:{eps:2*Math.random()+.5,revenue:50*Math.random()+10}}:void 0,s=[];for(let e=1;e<=4;e++){let a=new Date(t.getTime()-7776e6*e),i=150+50*Math.random(),n=(8*Math.random()+2)*(Math.random()>.5?1:-1),r=i*(1+n/100);s.push({date:a.toISOString().split("T")[0],realizedMovePct:Math.round(100*Math.abs(n))/100,priceChange:Math.round((r-i)*100)/100,priceBefore:Math.round(100*i)/100,priceAfter:Math.round(100*r)/100,volume:Math.floor(5e7*Math.random()+1e7)})}return{symbol:e.toUpperCase(),next:i,last:s.reverse(),timestamp:new Date().toISOString()}}}async function d(e){let t=Date.now();try{let a={symbol:new URL(e.url).searchParams.get("symbol")},i=(0,c.Gl)(c.z1,a);if(!i.success)return o.NextResponse.json((0,c.ql)(void 0,"Invalid request parameters",i.details?.join(", ")),{status:400});let{symbol:s}=i.data,n=p.ZU.earnings(s),r=p.Oj.earnings.get(n),d="l1";if(!r){let e=l.R8.earnings(s);d=(r=await l.ES.getJson(e))?"l2":"miss",r?p.Oj.earnings.set(n,r,3e5):(r=await m.getEarningsData(s),p.Oj.earnings.set(n,r,3e5),await l.ES.setJson(e,r,1800),d="miss")}let u=(0,c.ql)(r),g=Date.now()-t,h=new Headers({"Content-Type":"application/json","Cache-Control":"public, s-maxage=300, stale-while-revalidate=1800","X-Cache-Hit":d,"X-Processing-Time":`${g}ms`,"X-Symbol":s,"X-Has-Next-Earnings":r.next?"true":"false"});return o.NextResponse.json(u,{headers:h})}catch(t){console.error("[API] /api/earnings error:",t);let e=(0,c.ql)(void 0,"Internal server error",t instanceof Error?t.message:"Unknown error","Please check symbol format and try again");return o.NextResponse.json(e,{status:500})}}async function u(){return new o.NextResponse(null,{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, OPTIONS","Access-Control-Allow-Headers":"Content-Type"}})}let g=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/earnings/route",pathname:"/api/earnings",filename:"route",bundlePath:"app/api/earnings/route"},resolvedPagePath:"/Users/ken/Desktop/quantiv/app/api/earnings/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:h,staticGenerationAsyncStorage:y,serverHooks:v}=g,x="/api/earnings/route";function R(){return(0,r.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:y})}},7107:(e,t,a)=>{a.d(t,{MJ:()=>r,Oj:()=>n,ZU:()=>o});var i=a(138);class s{constructor(e,t={}){this.hits=0,this.misses=0,this.name=e,this.cache=new i.z({max:t.maxSize||100,ttl:t.ttlMs||6e4,updateAgeOnGet:t.updateAgeOnGet??!0,dispose:(e,t)=>{console.debug(`[${this.name}] Evicted cache entry: ${t}`)}})}get(e){let t=this.cache.get(e);return t?(this.hits++,t.data):(this.misses++,null)}set(e,t,a){let i={data:t,timestamp:Date.now(),key:e};a?this.cache.set(e,i,{ttl:a}):this.cache.set(e,i)}has(e){return this.cache.has(e)}delete(e){return this.cache.delete(e)}clear(){this.cache.clear(),this.hits=0,this.misses=0}getStats(){let e=this.hits+this.misses;return{name:this.name,size:this.cache.size,maxSize:this.cache.max,hits:this.hits,misses:this.misses,hitRate:e>0?this.hits/e*100:0,calculatedSize:this.cache.calculatedSize||0}}async getOrSet(e,t,a){let i=this.get(e);if(null!==i)return i;try{let i=await t();return this.set(e,i,a),i}catch(t){throw console.error(`[${this.name}] Error fetching data for key ${e}:`,t),t}}peek(e){let t=this.cache.peek(e);return t?t.data:null}keys(){return Array.from(this.cache.keys())}getInfo(){let e=[],t=Date.now();for(let[a,i]of Array.from(this.cache.entries()))e.push({key:a,timestamp:i.timestamp,age:t-i.timestamp});return{name:this.name,entries:e,stats:this.getStats()}}}let n={optionsChain:new s("options-chain",{maxSize:200,ttlMs:6e4,updateAgeOnGet:!0}),expectedMove:new s("expected-move",{maxSize:150,ttlMs:9e4,updateAgeOnGet:!0}),earnings:new s("earnings",{maxSize:100,ttlMs:3e5,updateAgeOnGet:!0}),priceHistory:new s("price-history",{maxSize:50,ttlMs:6e5,updateAgeOnGet:!1}),ivSeries:new s("iv-series",{maxSize:100,ttlMs:18e5,updateAgeOnGet:!1})};function r(){return{optionsChain:n.optionsChain.getStats(),expectedMove:n.expectedMove.getStats(),earnings:n.earnings.getStats(),priceHistory:n.priceHistory.getStats(),ivSeries:n.ivSeries.getStats()}}let o={optionsChain:(e,t)=>`${e.toUpperCase()}:${t}`,expectedMove:(e,t)=>`${e.toUpperCase()}:${t}`,earnings:e=>e.toUpperCase(),priceHistory:(e,t)=>`${e.toUpperCase()}:${t}d`,ivSeries:(e,t)=>`${e.toUpperCase()}:${t}d`}},6120:(e,t,a)=>{a.d(t,{ES:()=>n,O4:()=>r,R8:()=>s,pb:()=>o});let i=new(a(6859)).s({url:process.env.REDIS_URL,token:process.env.REDIS_TOKEN}),s={expectedMoveSnapshot:(e,t)=>`em:snap:${e.toUpperCase()}:${t}`,topMovers:e=>`em:top:${e}`,ivSeries:e=>`iv:series:${e.toUpperCase()}`,dailyVisits:e=>`d:visits:${e}`,optionsChain:(e,t)=>`chain:${e.toUpperCase()}:${t}`,earnings:e=>`earnings:${e.toUpperCase()}`,priceHistory:e=>`prices:${e.toUpperCase()}`};class n{static async setJson(e,t,a=120){try{await i.setex(e,a,JSON.stringify(t))}catch(t){console.error(`Redis setJson error for key ${e}:`,t)}}static async getJson(e){try{let t=await i.get(e);return t?JSON.parse(t):null}catch(t){return console.error(`Redis getJson error for key ${e}:`,t),null}}static async increment(e,t){try{let a=await i.incr(e);return t&&1===a&&await i.expire(e,t),a}catch(t){return console.error(`Redis increment error for key ${e}:`,t),0}}static async addToSortedSet(e,t,a,s){try{await i.zadd(e,{score:t,member:a}),s&&await i.expire(e,s)}catch(t){console.error(`Redis zadd error for key ${e}:`,t)}}static async getTopFromSortedSet(e,t=10){try{let a=await i.zrange(e,0,t-1,{rev:!0,withScores:!0}),s=[];for(let e=0;e<a.length;e+=2)s.push({member:a[e],score:a[e+1]});return s}catch(t){return console.error(`Redis zrange error for key ${e}:`,t),[]}}static async delete(e){try{await i.del(e)}catch(t){console.error(`Redis delete error for key ${e}:`,t)}}static async exists(e){try{let t=await i.exists(e);return 1===t}catch(t){return console.error(`Redis exists error for key ${e}:`,t),!1}}static async getTTL(e){try{return await i.ttl(e)}catch(t){return console.error(`Redis TTL error for key ${e}:`,t),-1}}}class r{static async cacheExpectedMove(e,t,a,i=120){let r=s.expectedMoveSnapshot(e,t),o={...a,timestamp:new Date().toISOString(),symbol:e.toUpperCase(),expiry:t};await n.setJson(r,o,i)}static async getExpectedMove(e,t){let a=s.expectedMoveSnapshot(e,t);return await n.getJson(a)}static async incrementVisitorCount(){let e=new Date().toISOString().split("T")[0].replace(/-/g,""),t=s.dailyVisits(e);return await n.increment(t,172800)}static async getVisitorCount(e){let t=e||new Date().toISOString().split("T")[0].replace(/-/g,""),a=s.dailyVisits(t);try{let e=await i.get(a);return e?parseInt(e,10):0}catch(e){return console.error(`Error getting visitor count for ${t}:`,e),0}}static async cacheIVSeries(e,t,a=86400){let i=s.ivSeries(e);await n.setJson(i,t,a)}static async getIVSeries(e){let t=s.ivSeries(e);return await n.getJson(t)}static async addTopMover(e,t,a){let i=a||new Date().toISOString().split("T")[0].replace(/-/g,""),r=s.topMovers(i);await n.addToSortedSet(r,t,e.toUpperCase(),86400)}static async getTopMovers(e,t=10){let a=e||new Date().toISOString().split("T")[0].replace(/-/g,""),i=s.topMovers(a);return(await n.getTopFromSortedSet(i,t)).map(e=>({symbol:e.member,expectedMovePct:e.score}))}}async function o(){try{let e=Date.now();await i.ping();let t=Date.now()-e;return{connected:!0,latency:t}}catch(e){return{connected:!1,error:e instanceof Error?e.message:"Unknown error"}}}},5074:(e,t,a)=>{a.d(t,{Gl:()=>v,Qp:()=>h,ql:()=>x,rJ:()=>g,z1:()=>y});var i=a(1585),s=a(6033);let n=i.Z_().min(1,"Symbol is required").max(10,"Symbol too long").regex(/^[A-Za-z0-9.-]+$/,"Invalid symbol format").transform(e=>e.toUpperCase()),r=i.Z_().regex(/^\d{4}-\d{2}-\d{2}$/,"Expiry must be in YYYY-MM-DD format").refine(e=>new Date(e)>new Date,"Expiry must be in the future"),o=i.Z_().regex(/^\d{4}-\d{2}-\d{2}$/,"Date must be in YYYY-MM-DD format"),c=i.Ry({strike:i.Rx().positive("Strike must be positive"),mid:i.Rx().nonnegative("Mid price cannot be negative"),bid:i.Rx().nonnegative("Bid price cannot be negative"),ask:i.Rx().nonnegative("Ask price cannot be negative"),iv:i.Rx().positive("IV must be positive").optional(),delta:i.Rx().optional(),gamma:i.Rx().optional(),theta:i.Rx().optional(),vega:i.Rx().optional(),rho:i.Rx().optional(),volume:i.Rx().nonnegative().optional(),openInterest:i.Rx().nonnegative().optional(),lastPrice:i.Rx().nonnegative().optional(),change:i.Rx().optional(),changePct:i.Rx().optional()});i.Ry({symbol:n,spot:i.Rx().positive("Spot price must be positive"),expiryDate:r,daysToExpiry:i.Rx().positive("Days to expiry must be positive"),strikes:i.IX(i.Rx().positive()).min(1,"At least one strike required"),calls:i.IX(c).min(1,"At least one call required"),puts:i.IX(c).min(1,"At least one put required"),timestamp:i.Z_().datetime().optional(),source:i.Z_().optional()});let p=i.Ry({straddle:i.Ry({abs:i.Rx().nonnegative("Straddle move cannot be negative"),pct:i.Rx().nonnegative("Straddle percentage cannot be negative")}),iv:i.Ry({abs:i.Rx().nonnegative("IV move cannot be negative"),pct:i.Rx().nonnegative("IV percentage cannot be negative")}),bands:i.Ry({oneSigma:i.Ry({upper:i.Rx(),lower:i.Rx()}),twoSigma:i.Ry({upper:i.Rx(),lower:i.Rx()})}),confidence:i.Ry({straddle:i.Km(["high","medium","low"]),iv:i.Km(["high","medium","low"])})}),l=i.Ry({rank:i.Rx().min(0).max(1,"IV rank must be between 0 and 1"),percentile:i.Rx().min(0).max(100,"Percentile must be between 0 and 100"),current:i.Rx().positive("Current IV must be positive"),min:i.Rx().positive("Min IV must be positive"),max:i.Rx().positive("Max IV must be positive"),mean:i.Rx().positive("Mean IV must be positive"),median:i.Rx().positive("Median IV must be positive"),stdDev:i.Rx().nonnegative("Standard deviation cannot be negative"),daysInSample:i.Rx().positive("Days in sample must be positive")}),m=i.Ry({date:o,confidence:i.Km(["confirmed","estimated"]),timing:i.Km(["bmo","amc","unknown"]).optional(),estimate:i.Ry({eps:i.Rx().optional(),revenue:i.Rx().optional()}).optional()}),d=i.Ry({date:o,realizedMovePct:i.Rx(),priceChange:i.Rx(),priceBefore:i.Rx().positive(),priceAfter:i.Rx().positive(),volume:i.Rx().nonnegative().optional()}),u=i.Ry({symbol:n,next:m.optional(),last:i.IX(d).max(8,"Maximum 8 historical earnings"),timestamp:i.Z_().datetime().optional()}),g=i.Ry({symbol:n,expiry:r.optional()}),h=i.Ry({symbol:n,expiry:r.optional()}),y=i.Ry({symbol:n});function v(e,t){try{let a=e.parse(t);return{success:!0,data:a}}catch(e){if(e instanceof s.jm)return{success:!1,error:"Validation failed",details:e.errors.map(e=>`${e.path.join(".")}: ${e.message}`)};return{success:!1,error:"Unknown validation error",details:[e instanceof Error?e.message:"Unknown error"]}}}function x(e,t,a,i){return{success:!t,...e&&{data:e},...t&&{error:t},...a&&{detail:a},...i&&{hint:i},timestamp:new Date().toISOString()}}i.Ry({date:o.optional(),limit:i.Rx().min(1).max(50).default(10)}),i.Ry({success:i.O7(),data:i.Ry({spot:i.Rx().positive(),expiryUsed:r,atm:i.Ry({strike:i.Rx().positive(),callMid:i.Rx().nonnegative(),putMid:i.Rx().nonnegative(),iv:i.Rx().positive(),T:i.Rx().positive()}),rows:i.IX(i.Ry({strike:i.Rx().positive(),call:c,put:c}))}).optional(),error:i.Z_().optional(),timestamp:i.Z_().datetime()}),i.Ry({success:i.O7(),data:i.Ry({em:p,ivRank:l}).optional(),error:i.Z_().optional(),timestamp:i.Z_().datetime()}),i.Ry({success:i.O7(),data:u.optional(),error:i.Z_().optional(),timestamp:i.Z_().datetime()}),i.Ry({success:i.O7(),data:i.Ry({count:i.Rx().nonnegative()}).optional(),error:i.Z_().optional(),timestamp:i.Z_().datetime()}),i.Ry({success:i.O7(),data:i.IX(i.Ry({symbol:n,expectedMovePct:i.Rx().nonnegative(),spot:i.Rx().positive().optional(),volume:i.Rx().nonnegative().optional()})).optional(),error:i.Z_().optional(),timestamp:i.Z_().datetime()}),i.Ry({success:i.i0(!1),error:i.Z_(),detail:i.Z_().optional(),hint:i.Z_().optional(),timestamp:i.Z_().datetime()}),i.Ry({status:i.Km(["healthy","degraded","unhealthy"]),timestamp:i.Z_().datetime(),services:i.Ry({redis:i.Ry({connected:i.O7(),latency:i.Rx().optional(),error:i.Z_().optional()}),cache:i.Ry({l1Stats:i.IM(i.Ry({size:i.Rx(),hitRate:i.Rx()}))})}),version:i.Z_().optional()})}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),i=t.X(0,[276,982,585,138],()=>a(8466));module.exports=i})();